
<html><head><base href="./" />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/jpg" href="./imagenes/caragrande.png"/>
<title>Dibujemos</title>
<style>
    /* Keeping all existing styles up to the media queries */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    .toolbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #f0f0f0;
        padding: 10px;
        display: flex;
        gap: 10px;
        border-bottom: 1px solid #ccc;
        z-index: 100;
    }

    .tool-group {
        display: flex;
        gap: 5px;
        align-items: center;
        padding: 0 10px;
        border-right: 1px solid #ccc;
    }

    button {
        padding: 5px 10px;
        cursor: pointer;
        background: white;
        border: 1px solid #999;
        border-radius: 3px;
    }

    button:hover {
        background: #e0e0e0;
    }

    button.active {
        background: #007bff;
        color: white;
    }

    #color-picker {
        width: 40px;
        height: 40px;
        padding: 0;
    }

    #size-slider {
        width: 100px;
    }

    .color-presets {
        display: flex;
        gap: 5px;
    }

    .color-preset {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #fff;
        box-shadow: 0 0 0 1px #ccc;
        transition: transform 0.2s;
    }

    .color-preset:hover {
        transform: scale(1.1);
    }

    canvas {
        position: fixed;
        top: 60px;
        left: 0;
        background: white;
    }

    .shapes-dropdown {
        position: relative;
        display: inline-block;
    }

    .shapes-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .shapes-content button {
        width: 100%;
        text-align: left;
    }

    .shapes-dropdown:hover .shapes-content {
        display: block;
    }

    @media (max-width: 768px) {
        .toolbar {
            flex-wrap: wrap;
            padding: 5px;
        }

        .tool-group {
            padding: 5px;
        }

        button {
            padding: 3px 6px;
            font-size: 14px;
        }

        #size-slider {
            width: 80px;
        }

        .color-presets {
            display: flex;
        }

        #color-picker {
            width: 30px;
            height: 30px;
        }
    }

    @media (max-width: 480px) {
        .toolbar {
            padding: 3px;
        }

        .tool-group {
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            border-bottom: 1px solid #ccc;
            border-right: none;
        }

        button {
            font-size: 12px;
        }

        .shapes-content {
            position: fixed;
            left: 0;
            right: 0;
            width: 100%;
        }

        .color-presets {
            display: none;
        }

        .home-link {
            width: 100%;
            justify-content: center;
            margin-bottom: 5px;
        }
    }

    .home-link {
        text-decoration: none;
        font-size: 24px;
        padding: 5px 10px;
        color: #333;
        display: flex;
        align-items: center;
    }

    .home-link:hover {
        color: #007bff;
    }
</style>
</head>
<body>
    <div class="toolbar">
        <a href="./index.html" class="home-link"> <img class="fw-bold" src="./imagenes/home.svg" alt="" width="50px" > </a>
        <div class="tool-group">
            <button id="pencil" class="active">‚úèÔ∏è L√°piz</button>
            <button id="eraser">üßπ Borrador</button>
            <button id="fillBucket">üé® Pintar</button>
            <div class="shapes-dropdown">
                <button id="shapes">üìê Figuras</button>
                <div class="shapes-content">
                    <button id="rectangle">‚¨ú Rect√°ngulo</button>
                    <button id="circle">‚≠ï C√≠rculo</button>
                    <button id="line">üìè L√≠nea</button>
                </div>
            </div>
        </div>
        <div class="tool-group">
            <input type="color" id="color-picker" value="#000000">
            <div class="color-presets">
                <div class="color-preset" style="background: #ff0000"></div>
                <div class="color-preset" style="background: #00ff00"></div>
                <div class="color-preset" style="background: #ff09bd"></div>
                <div class="color-preset" style="background: #ffae00"></div>
                <div class="color-preset" style="background: #0000ff"></div>
                <div class="color-preset" style="background: #ffff00"></div>
                <div class="color-preset" style="background: #fa82fa"></div>
                <div class="color-preset" style="background: #00ffff"></div>
            </div>
            <span>Grosor:</span>
            <input type="range" id="size-slider" min="1" max="100" value="5">
        </div>
        <div class="tool-group">
            <button id="undo">‚Ü©Ô∏è Deshacer</button>
            <button id="clear">üóëÔ∏è Limpiar</button>
            <button id="save">üíæ Guardar</button>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let currentTool = 'pencil';
        let startX = 0;
        let startY = 0;
        let snapshot = '';
        let undoStack = [];
    
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 60;
    
            // Inicializar el lienzo con un color base (blanco)
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
    
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
    
        const toolButtons = document.querySelectorAll('.toolbar button');
        const colorPicker = document.getElementById('color-picker');
        const sizeSlider = document.getElementById('size-slider');
        const colorPresets = document.querySelectorAll('.color-preset');
    
        colorPresets.forEach(preset => {
            preset.addEventListener('click', () => {
                const color = window.getComputedStyle(preset).backgroundColor;
                colorPicker.value = rgbToHex(color);
            });
        });
    
        function rgbToHex(rgb) {
            const rgbValues = rgb.match(/\d+/g);
            const r = parseInt(rgbValues[0]);
            const g = parseInt(rgbValues[1]);
            const b = parseInt(rgbValues[2]);
            return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
    
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return [r, g, b];
        }
    
        function getColorAtPixel(imageData, x, y) {
            const index = (y * imageData.width + x) * 4;
            return [
                imageData.data[index],
                imageData.data[index + 1],
                imageData.data[index + 2],
                imageData.data[index + 3]
            ];
        }
    
        function setColorAtPixel(imageData, x, y, color) {
            const index = (y * imageData.width + x) * 4;
            imageData.data[index] = color[0];
            imageData.data[index + 1] = color[1];
            imageData.data[index + 2] = color[2];
            imageData.data[index + 3] = 255;
        }
    
        function colorsMatch(a, b, tolerance = 0) {
            return Math.abs(a[0] - b[0]) <= tolerance &&
                   Math.abs(a[1] - b[1]) <= tolerance &&
                   Math.abs(a[2] - b[2]) <= tolerance;
        }
    
        function floodFill(startX, startY, fillColor) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const targetColor = getColorAtPixel(imageData, startX, startY);
            const fillColorRgb = hexToRgb(fillColor);
            
            if (colorsMatch(targetColor, fillColorRgb)) return;
    
            const pixelsToCheck = [[startX, startY]];
            const visited = new Set();
    
            while (pixelsToCheck.length > 0) {
                const [x, y] = pixelsToCheck.pop();
                const key = `${x},${y}`;
    
                if (visited.has(key) || x < 0 || x >= imageData.width || y < 0 || y >= imageData.height) continue;
    
                visited.add(key);
                const currentColor = getColorAtPixel(imageData, x, y);
    
                if (!colorsMatch(currentColor, targetColor)) continue;
    
                setColorAtPixel(imageData, x, y, fillColorRgb);
    
                pixelsToCheck.push([x + 1, y]);
                pixelsToCheck.push([x - 1, y]);
                pixelsToCheck.push([x, y + 1]);
                pixelsToCheck.push([x, y - 1]);
            }
    
            ctx.putImageData(imageData, 0, 0);
        }
    
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (!['undo', 'clear', 'save', 'shapes'].includes(button.id)) {
                    document.querySelector('.active')?.classList.remove('active');
                    button.classList.add('active');
                    currentTool = button.id;
                }
            });
        });
    
        function saveState() {
            undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            if (undoStack.length > 20) undoStack.shift();
        }
    
        function startDrawing(e) {
            isDrawing = true;
            [startX, startY] = [e.offsetX, e.offsetY];
            
            if (currentTool === 'fillBucket') {
                saveState();
                floodFill(startX, startY, colorPicker.value);
                return;
            }
    
            ctx.beginPath();
            ctx.lineWidth = sizeSlider.value;
            ctx.strokeStyle = colorPicker.value;
            ctx.fillStyle = colorPicker.value;
            snapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
            saveState();
        }
    
        function draw(e) {
            if (!isDrawing || currentTool === 'fillBucket') return;
            
            switch(currentTool) {
                case 'pencil':
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                    break;
                case 'eraser':
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                    break;
                case 'rectangle':
                    ctx.putImageData(snapshot, 0, 0);
                    drawRectangle(e);
                    break;
                case 'circle':
                    ctx.putImageData(snapshot, 0, 0);
                    drawCircle(e);
                    break;
                case 'line':
                    ctx.putImageData(snapshot, 0, 0);
                    drawLine(e);
                    break;
            }
        }
    
        function stopDrawing() {
            isDrawing = false;
        }
    
        function drawRectangle(e) {
            const width = e.offsetX - startX;
            const height = e.offsetY - startY;
            ctx.strokeRect(startX, startY, width, height);
        }
    
        function drawCircle(e) {
            ctx.beginPath();
            const radius = Math.sqrt(Math.pow(e.offsetX - startX, 2) + Math.pow(e.offsetY - startY, 2));
            ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
            ctx.stroke();
        }
    
        function drawLine(e) {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        }
    
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
    
        document.getElementById('undo').addEventListener('click', () => {
            if (undoStack.length > 0) {
                ctx.putImageData(undoStack.pop(), 0, 0);
            }
        });
    
        document.getElementById('clear').addEventListener('click', () => {
            saveState();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        });
    
        document.getElementById('save').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'dibujo.png';
            link.href = canvas.toDataURL();
            link.click();
        });
        
    </script>
    
</body>
</html>